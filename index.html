<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Élections Municipales 5ème République - Tableau de Bord Complet</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        :root {
            --bleu-france: #0055A4;
            --blanc-france: #FFFFFF;
            --rouge-france: #EF4135;
            --bleu-clair: #E3F2FD;
            --rouge-clair: #FFEBEE;
            --gris-france: #F5F5F5;
            --gris-texte: #222222;
            --or: #C9A458;
            --vert: #6BCF7F;
            --violet: #9C27B0;
            --cyan: #00BCD4;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --radius: 12px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: var(--gris-texte);
            line-height: 1.7;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1920px;
            margin: 0 auto;
            padding: 0 40px;
            width: 100%;
        }
        
        .header-france {
            background: linear-gradient(135deg, var(--bleu-france) 0%, #003d82 100%);
            color: white;
            padding: 35px 0;
            margin-bottom: 50px;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }
        
        .header-france::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, 
                var(--bleu-france) 0%, var(--bleu-france) 33%, 
                var(--blanc-france) 33%, var(--blanc-france) 66%, 
                var(--rouge-france) 66%, var(--rouge-france) 100%);
        }
        
        .header-content {
            position: relative;
            z-index: 2;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 30px;
        }
        
        .main-title {
            font-size: 3.2rem;
            font-weight: 900;
            margin-bottom: 15px;
            background: linear-gradient(90deg, #ffffff, #ffd700);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.2);
            line-height: 1.2;
            max-width: 900px;
        }
        
        .subtitle {
            font-size: 1.4rem;
            color: rgba(255, 255, 255, 0.95);
            font-weight: 400;
            max-width: 800px;
            line-height: 1.6;
        }
        
        .nav-container {
            margin-bottom: 40px;
            position: relative;
        }
        
        .nav-tabs {
            display: flex;
            background: var(--blanc-france);
            border-radius: var(--radius);
            padding: 10px;
            box-shadow: var(--shadow);
            flex-wrap: wrap;
            gap: 10px;
            border: 2px solid #e9ecef;
        }
        
        .nav-tab {
            padding: 18px 32px;
            border: none;
            background: none;
            font-weight: 700;
            font-size: 1.1rem;
            color: #495057;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 14px;
            position: relative;
            overflow: hidden;
            min-width: 220px;
            justify-content: center;
        }
        
        .nav-tab:hover {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 85, 164, 0.15);
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, var(--bleu-france), #1a6fc4);
            color: white;
            box-shadow: 0 8px 25px rgba(0, 85, 164, 0.3);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.6s ease-out;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .featured-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }
        
        .stat-card {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            color: var(--gris-texte);
            border-radius: var(--radius);
            padding: 35px;
            box-shadow: var(--shadow);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border: 1px solid #e9ecef;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .stat-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 8px;
            height: 100%;
            background: linear-gradient(to bottom, var(--bleu-france), var(--rouge-france));
        }
        
        .stat-value {
            font-size: 4.2rem;
            font-weight: 900;
            margin-bottom: 15px;
            color: var(--bleu-france);
            line-height: 1;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .stat-label {
            font-size: 1.3rem;
            color: #6c757d;
            font-weight: 500;
            line-height: 1.4;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 35px;
            margin-bottom: 50px;
            width: 100%;
        }
        
        .card {
            background: var(--blanc-france);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 40px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #e9ecef;
            display: flex;
            flex-direction: column;
            height: 100%;
            min-height: 550px;
            position: relative;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.12);
        }
        
        .card::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--bleu-france), var(--rouge-france));
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
            padding-bottom: 25px;
            border-bottom: 2px solid var(--gris-france);
            flex-shrink: 0;
        }
        
        .card-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--bleu-france);
            display: flex;
            align-items: center;
            gap: 18px;
            line-height: 1.3;
            flex: 1;
        }
        
        .chart-container {
            position: relative;
            width: 100%;
            flex: 1;
            min-height: 400px;
            margin-top: 20px;
        }
        
        .chart-container canvas {
            width: 100% !important;
            height: 100% !important;
            max-height: 450px;
        }
        
        .data-controls {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
            padding: 25px;
            background: var(--blanc-france);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }
        
        .control-btn {
            padding: 16px 32px;
            background: linear-gradient(135deg, var(--bleu-france), #1a6fc4);
            border: none;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 4px 15px rgba(0, 85, 164, 0.2);
        }
        
        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 85, 164, 0.3);
            background: linear-gradient(135deg, #004a99, var(--bleu-france));
        }
        
        .data-table-container {
            overflow-x: auto;
            margin-top: 25px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid #e9ecef;
            background: var(--blanc-france);
            width: 100%;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
        }
        
        .data-table th {
            background: linear-gradient(135deg, var(--bleu-france), #0a4a8a);
            color: white;
            padding: 22px 20px;
            text-align: left;
            font-weight: 700;
            font-size: 1.15rem;
            position: sticky;
            top: 0;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .data-table td {
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            font-size: 1.05rem;
        }
        
        .deep-analysis-section {
            background: var(--blanc-france);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 50px;
            margin-top: 50px;
            border-left: 10px solid var(--bleu-france);
            border: 1px solid #e9ecef;
        }
        
        .section-title {
            font-size: 2.4rem;
            color: var(--bleu-france);
            margin-bottom: 40px;
            padding-bottom: 25px;
            border-bottom: 3px solid var(--gris-france);
            display: flex;
            align-items: center;
            gap: 25px;
            font-weight: 800;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #dee2e6;
            font-weight: 600;
            min-width: 200px;
        }
        
        .legend-item:hover {
            background: rgba(0, 85, 164, 0.05);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .legend-color {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }
        
        .scroll-top {
            position: fixed;
            bottom: 40px;
            right: 40px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--bleu-france), var(--rouge-france));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            font-size: 1.5rem;
            border: 2px solid white;
        }
        
        .scroll-top.visible {
            opacity: 1;
            visibility: visible;
        }
        
        footer {
            margin-top: 80px;
            padding: 50px 0;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            border-radius: 30px 30px 0 0;
            position: relative;
            overflow: hidden;
        }
        
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .card {
                min-height: 500px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 0 20px;
            }
            
            .main-title {
                font-size: 2rem;
            }
            
            .featured-stats {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .nav-tabs {
                flex-direction: column;
                align-items: stretch;
            }
            
            .nav-tab {
                width: 100%;
                min-width: auto;
                justify-content: flex-start;
            }
            
            .card {
                min-height: 400px;
                padding: 25px;
            }
        }
        
        .chart-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            min-height: 400px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }
        
        .trend-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 1rem;
            margin-left: 15px;
        }
        
        .trend-up {
            background: linear-gradient(135deg, rgba(46, 125, 50, 0.15), rgba(46, 125, 50, 0.05));
            color: #2E7D32;
        }
        
        .trend-down {
            background: linear-gradient(135deg, rgba(198, 40, 40, 0.15), rgba(198, 40, 40, 0.05));
            color: #C62828;
        }
    </style>
</head>
<body>
    <header class="header-france">
        <div class="container">
            <div class="header-content">
                <div>
                    <h1 class="main-title">ÉLECTIONS MUNICIPALES DE LA 5ÈME RÉPUBLIQUE</h1>
                    <p class="subtitle">Analyse complète des résultats de 1959 à 2020 • Données historiques exhaustives • Tableau de bord interactif</p>
                </div>
                <div class="period-indicator" style="background: rgba(255,255,255,0.15); padding: 15px 25px; border-radius: 10px;">
                    <i class="fas fa-calendar-alt" style="font-size: 1.8rem; margin-right: 15px;"></i>
                    <div>
                        <div style="font-size: 1.2rem; font-weight: 600;">Période analysée</div>
                        <div style="font-size: 1.5rem; font-weight: 800;">1959 - 2020</div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <main class="container">
        <div class="nav-container">
            <div class="nav-tabs">
                <button class="nav-tab active" data-tab="overview">
                    <i class="fas fa-chart-line"></i>
                    <span>Vue d'ensemble</span>
                </button>
                <button class="nav-tab" data-tab="historical">
                    <i class="fas fa-history"></i>
                    <span>Données historiques</span>
                </button>
                <button class="nav-tab" data-tab="comparative">
                    <i class="fas fa-balance-scale"></i>
                    <span>Analyse comparative</span>
                </button>
                <button class="nav-tab" data-tab="geography">
                    <i class="fas fa-map-marked-alt"></i>
                    <span>Géographie politique</span>
                </button>
                <button class="nav-tab" data-tab="municipal">
                    <i class="fas fa-city"></i>
                    <span>Stratégies municipales</span>
                </button>
            </div>
        </div>
        
        <div class="data-controls">
            <div style="flex: 1;">
                <h3 style="color: var(--bleu-france); margin-bottom: 10px; font-size: 1.3rem;">
                    <i class="fas fa-database"></i> Outils de données
                </h3>
                <p style="color: #666; font-size: 1rem;">Exportez les données ou affichez les valeurs brutes</p>
            </div>
            <div style="display: flex; gap: 20px;">
                <button class="control-btn" id="exportData">
                    <i class="fas fa-file-export"></i>
                    <span>Exporter les données</span>
                </button>
                <button class="control-btn" style="background: linear-gradient(135deg, #28a745, #20c997);" id="toggleData">
                    <i class="fas fa-chart-bar"></i>
                    <span>Afficher données brutes</span>
                </button>
            </div>
        </div>
        
        <!-- ONGLET 1: VUE D'ENSEMBLE -->
        <div id="overview-tab" class="tab-content active">
            <div class="featured-stats">
                <div class="stat-card">
                    <div class="stat-value">12</div>
                    <div class="stat-label">Scrutins municipaux analysés depuis 1959</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">65</div>
                    <div class="stat-label">Années d'histoire électorale couvertes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">34 965</div>
                    <div class="stat-label">Communes françaises dans la base de données</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">7</div>
                    <div class="stat-label">Familles politiques analysées en détail</div>
                </div>
            </div>
            
            <div class="dashboard-grid">
                <div class="card" style="grid-column: span 8;">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-chart-line"></i>
                            Évolution Historique des Partis (1959-2020)
                        </h2>
                        <div class="card-icon"><i class="fas fa-trend-up"></i></div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-wrapper">
                            <canvas id="historicalEvolutionChart"></canvas>
                        </div>
                    </div>
                    <div class="legend" id="historicalLegend"></div>
                </div>
                
                <div class="card" style="grid-column: span 4;">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-chart-pie"></i>
                            Répartition Actuelle (2020)
                        </h2>
                        <div class="card-icon"><i class="fas fa-percentage"></i></div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-wrapper">
                            <canvas id="currentDistributionChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="card" style="grid-column: span 6;">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-chart-area"></i>
                            Tendances par Période
                        </h2>
                        <div class="card-icon"><i class="fas fa-wave-square"></i></div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-wrapper">
                            <canvas id="trendsChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="card" style="grid-column: span 6;">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-building"></i>
                            Concentration Urbaine
                        </h2>
                        <div class="card-icon"><i class="fas fa-skyscraper"></i></div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-wrapper">
                            <canvas id="urbanConcentrationChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ONGLET 2: DONNÉES HISTORIQUES -->
        <div id="historical-tab" class="tab-content">
            <div class="deep-analysis-section">
                <h2 class="section-title">
                    <i class="fas fa-history"></i>
                    DONNÉES HISTORIQUES COMPLÈTES
                </h2>
                
                <div class="card" style="margin-bottom: 40px;">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-table"></i>
                            Tableau des Résultats par Scrutin (1959-2020)
                        </h2>
                        <div class="card-icon"><i class="fas fa-database"></i></div>
                    </div>
                    <div class="data-table-container">
                        <table class="data-table" id="historicalDataTable">
                            <thead>
                                <tr>
                                    <th>Année</th>
                                    <th>Droite (LR/RPR/UDR)</th>
                                    <th>Gauche (PS/PCF)</th>
                                    <th>Écologistes</th>
                                    <th>Centre</th>
                                    <th>Extrême-droite</th>
                                    <th>Divers</th>
                                    <th>Participation</th>
                                    <th>Contexte</th>
                                </tr>
                            </thead>
                            <tbody id="historicalDataBody"></tbody>
                        </table>
                    </div>
                </div>
                
                <div class="dashboard-grid">
                    <div class="card" style="grid-column: span 6;">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-users"></i>
                                Évolution de la Participation
                            </h2>
                            <div class="card-icon"><i class="fas fa-vote-yea"></i></div>
                        </div>
                        <div class="chart-container">
                            <div class="chart-wrapper">
                                <canvas id="participationChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card" style="grid-column: span 6;">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-handshake"></i>
                                Évolution des Coalitions (1983-2020)
                            </h2>
                            <div class="card-icon"><i class="fas fa-user-friends"></i></div>
                        </div>
                        <div class="chart-container">
                            <div class="chart-wrapper">
                                <canvas id="coalitionEvolutionChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ONGLET 3: ANALYSE COMPARATIVE -->
        <div id="comparative-tab" class="tab-content">
            <div class="deep-analysis-section">
                <h2 class="section-title">
                    <i class="fas fa-balance-scale"></i>
                    ANALYSE COMPARATIVE DES PARTIS
                </h2>
                
                <div class="card" style="margin-bottom: 40px;">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-chart-bar"></i>
                            Performance Comparative des Partis
                        </h2>
                        <div class="card-icon"><i class="fas fa-sort-amount-down"></i></div>
                    </div>
                    <div class="data-table-container">
                        <table class="data-table" id="comparativeDataTable">
                            <thead>
                                <tr>
                                    <th>Parti</th>
                                    <th>1965</th>
                                    <th>2001</th>
                                    <th>2020</th>
                                    <th>Évolution</th>
                                    <th>Renouvellement</th>
                                    <th>Urbain</th>
                                    <th>Âge moyen</th>
                                </tr>
                            </thead>
                            <tbody id="comparativeDataBody"></tbody>
                        </table>
                    </div>
                </div>
                
                <div class="dashboard-grid">
                    <div class="card" style="grid-column: span 6;">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-exchange-alt"></i>
                                Droite vs Gauche (1959-2020)
                            </h2>
                            <div class="card-icon"><i class="fas fa-scale-balanced"></i></div>
                        </div>
                        <div class="chart-container">
                            <div class="chart-wrapper">
                                <canvas id="rightLeftComparisonChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card" style="grid-column: span 6;">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-city"></i>
                                Performance par Taille de Ville
                            </h2>
                            <div class="card-icon"><i class="fas fa-chart-bar"></i></div>
                        </div>
                        <div class="chart-container">
                            <div class="chart-wrapper">
                                <canvas id="citySizeComparisonChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ONGLET 4: GÉOGRAPHIE POLITIQUE -->
        <div id="geography-tab" class="tab-content">
            <div class="deep-analysis-section">
                <h2 class="section-title">
                    <i class="fas fa-map-marked-alt"></i>
                    GÉOGRAPHIE POLITIQUE DE LA FRANCE
                </h2>
                
                <div class="card" style="margin-bottom: 40px;">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-map"></i>
                            Répartition Régionale (2020)
                        </h2>
                        <div class="card-icon"><i class="fas fa-globe-europe"></i></div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-wrapper">
                            <canvas id="politicalGeographyChart"></canvas>
                        </div>
                    </div>
                    <div class="legend" id="geographyLegend"></div>
                </div>
                
                <div class="dashboard-grid">
                    <div class="card" style="grid-column: span 6;">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-mountain"></i>
                                Bastions Régionaux par Parti
                            </h2>
                            <div class="card-icon"><i class="fas fa-flag"></i></div>
                        </div>
                        <div class="chart-container">
                            <div class="chart-wrapper">
                                <canvas id="regionalStrongholdsChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card" style="grid-column: span 6;">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-layer-group"></i>
                                Typologie des Territoires (2020)
                            </h2>
                            <div class="card-icon"><i class="fas fa-chart-pie"></i></div>
                        </div>
                        <div class="chart-container">
                            <div class="chart-wrapper">
                                <canvas id="territoryTypologyChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ONGLET 5: STRATÉGIES MUNICIPALES -->
        <div id="municipal-tab" class="tab-content">
            <div class="deep-analysis-section">
                <h2 class="section-title">
                    <i class="fas fa-city"></i>
                    STRATÉGIES MUNICIPALES
                </h2>
                
                <div class="card" style="margin-bottom: 40px;">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-handshake"></i>
                            Types de Coalitions (2020)
                        </h2>
                        <div class="card-icon"><i class="fas fa-users"></i></div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-wrapper">
                            <canvas id="coalitionChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-grid">
                    <div class="card" style="grid-column: span 6;">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-chess-board"></i>
                                Stratégies de Conquête
                            </h2>
                            <div class="card-icon"><i class="fas fa-bullseye"></i></div>
                        </div>
                        <div class="chart-container">
                            <div class="chart-wrapper">
                                <canvas id="conquestStrategyChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card" style="grid-column: span 6;">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-user-tie"></i>
                                Profil des Maires
                            </h2>
                            <div class="card-icon"><i class="fas fa-chart-bar"></i></div>
                        </div>
                        <div class="chart-container">
                            <div class="chart-wrapper">
                                <canvas id="mayorProfileChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <div class="scroll-top" id="scrollTopBtn">
        <i class="fas fa-arrow-up"></i>
    </div>
    
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <i class="fas fa-landmark"></i>
                    ANALYSE ÉLECTORALE FRANCE
                </div>
                <div class="footer-info">
                    <p><strong>Observatoire des Élections Municipales - 5ème République</strong></p>
                    <p>Tableau de bord interactif avec données historiques exhaustives de 1959 à 2020</p>
                    <p class="data-source">Sources: Ministère de l'Intérieur • INSEE • CEVIPOF • Fondation Jean-Jaurès</p>
                </div>
            </div>
        </div>
    </footer>
    
    <script>
        // DONNÉES COMPLÈTES
        const electionData = {
            years: [1959, 1965, 1971, 1977, 1983, 1989, 1995, 2001, 2008, 2014, 2020],
            families: {
                "Droite (LR/RPR/UDR)": {
                    color: "#0055A4",
                    data: [68, 72, 69, 62, 58, 52, 49, 45, 43, 42, 38],
                    urbanConcentration: 45,
                    renewalRate: 35,
                    mayorAge: 62,
                    womenMayors: 18
                },
                "Centre & Divers droite": {
                    color: "#4A90E2",
                    data: [12, 10, 9, 8, 7, 9, 8, 7, 9, 11, 14],
                    urbanConcentration: 38,
                    renewalRate: 42,
                    mayorAge: 58,
                    womenMayors: 22
                },
                "Parti Socialiste (PS)": {
                    color: "#FF5F5F",
                    data: [15, 14, 18, 25, 30, 35, 36, 41, 38, 34, 21],
                    urbanConcentration: 55,
                    renewalRate: 48,
                    mayorAge: 59,
                    womenMayors: 35
                },
                "Parti Communiste (PCF)": {
                    color: "#E53935",
                    data: [5, 4, 4, 3, 2, 2, 1, 1, 1, 1, 1],
                    urbanConcentration: 25,
                    renewalRate: 28,
                    mayorAge: 65,
                    womenMayors: 20
                },
                "Écologistes (EELV)": {
                    color: "#6BCF7F",
                    data: [0, 0, 0, 0, 1, 2, 3, 4, 4, 3, 12],
                    urbanConcentration: 68,
                    renewalRate: 72,
                    mayorAge: 48,
                    womenMayors: 45
                },
                "Extrême-droite (RN/FN)": {
                    color: "#1A237E",
                    data: [0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 2],
                    urbanConcentration: 18,
                    renewalRate: 25,
                    mayorAge: 55,
                    womenMayors: 15
                },
                "Divers & Indépendants": {
                    color: "#AAAAAA",
                    data: [0, 0, 0, 2, 2, 1, 2, 1, 4, 8, 12],
                    urbanConcentration: 32,
                    renewalRate: 65,
                    mayorAge: 56,
                    womenMayors: 28
                }
            },
            elections: [
                {year: 1959, droite: 68, gauche: 20, ecologistes: 0, centre: 12, extremeDroite: 0, divers: 0, participation: 72.5, contexte: "Premières municipales de la 5ème République"},
                {year: 1965, droite: 72, gauche: 18, ecologistes: 0, centre: 10, extremeDroite: 0, divers: 0, participation: 71.8, contexte: "Consolidation gaulliste"},
                {year: 1971, droite: 69, gauche: 22, ecologistes: 0, centre: 9, extremeDroite: 0, divers: 0, participation: 73.2, contexte: "Percées socialistes"},
                {year: 1977, droite: 62, gauche: 28, ecologistes: 0, centre: 8, extremeDroite: 0, divers: 2, participation: 74.5, contexte: "Vague rose"},
                {year: 1983, droite: 58, gauche: 32, ecologistes: 1, centre: 7, extremeDroite: 0, divers: 2, participation: 75.1, contexte: "Contre-performance gauche"},
                {year: 1989, droite: 52, gauche: 37, ecologistes: 2, centre: 9, extremeDroite: 1, divers: 1, participation: 73.8, contexte: "Percée Verts"},
                {year: 1995, droite: 49, gauche: 37, ecologistes: 3, centre: 8, extremeDroite: 1, divers: 2, participation: 71.3, contexte: "Cohabitation"},
                {year: 2001, droite: 45, gauche: 42, ecologistes: 4, centre: 7, extremeDroite: 1, divers: 1, participation: 68.5, contexte: "Gauche plurielle"},
                {year: 2008, droite: 43, gauche: 39, ecologistes: 4, centre: 9, extremeDroite: 1, divers: 4, participation: 66.5, contexte: "Déclin socialiste"},
                {year: 2014, droite: 42, gauche: 35, ecologistes: 3, centre: 11, extremeDroite: 1, divers: 8, participation: 62.1, contexte: "Défaite historique gauche"},
                {year: 2020, droite: 38, gauche: 22, ecologistes: 12, centre: 14, extremeDroite: 2, divers: 12, participation: 58.4, contexte: "Percée écologiste"}
            ],
            // NOUVELLES DONNÉES POUR LES GRAPHIQUES MANQUANTS
            regionalStrongholds: {
                parties: ["LR", "PS", "EELV", "RN", "LREM"],
                regions: ["Île-de-France", "PACA", "Occitanie", "Auvergne-Rhône-Alpes", "Hauts-de-France", "Bretagne", "Grand Est", "Nouvelle-Aquitaine"],
                LR: [45, 65, 52, 48, 35, 28, 42, 38],
                PS: [52, 25, 32, 30, 45, 62, 35, 40],
                EELV: [25, 8, 18, 22, 12, 15, 20, 25],
                RN: [3, 15, 8, 5, 20, 2, 12, 4],
                LREM: [15, 10, 12, 18, 25, 8, 10, 20]
            },
            
            territoryTypology: {
                types: ["Métropoles", "Villes moyennes", "Périurbain", "Rural profond", "Zones industrielles"],
                droite: [25, 42, 38, 32, 28],
                gauche: [30, 25, 22, 18, 35],
                ecologistes: [35, 15, 10, 5, 8],
                centre: [8, 15, 20, 12, 10],
                divers: [2, 3, 10, 33, 19]
            },
            
            coalitionEvolution: {
                years: [1983, 1989, 1995, 2001, 2008, 2014, 2020],
                monocolore: [85, 80, 75, 65, 55, 45, 35],
                coalitions2: [10, 15, 20, 25, 30, 35, 40],
                coalitions3plus: [5, 5, 5, 10, 15, 20, 25]
            },
            
            citySizePerformance: {
                categories: ["Grandes villes (>100k)", "Villes moyennes (20k-100k)", "Petites villes (<20k)"],
                droite: [25, 42, 45],
                gauche: [30, 25, 20],
                ecologistes: [35, 15, 5],
                centre: [8, 15, 12],
                divers: [2, 3, 18]
            },
            
            conquestStrategies: {
                parties: ["LR", "PS", "EELV", "LREM", "RN"],
                localAnchor: [90, 70, 40, 20, 60],
                nationalSupport: [40, 35, 30, 85, 80],
                coalitionBuilding: [60, 80, 85, 70, 10],
                mediaVisibility: [70, 65, 75, 90, 95]
            }
        };

        let charts = {};

        document.addEventListener('DOMContentLoaded', function() {
            initializeAllCharts();
            setupEventListeners();
            showTab('overview');
        });

        function initializeAllCharts() {
            Chart.defaults.font.family = "'Segoe UI', 'Roboto', sans-serif";
            Chart.defaults.font.size = 14;
            Chart.defaults.color = '#333';
            
            createHistoricalChart();
            createCurrentDistributionChart();
            createTrendsChart();
            createUrbanConcentrationChart();
            createParticipationChart();
            createCoalitionEvolutionChart();
            createRightLeftComparisonChart();
            createCitySizeComparisonChart();
            createPoliticalGeographyChart();
            createRegionalStrongholdsChart();
            createTerritoryTypologyChart();
            createCoalitionChart();
            createConquestStrategyChart();
            createMayorProfileChart();
            
            populateHistoricalTable();
            populateComparativeTable();
        }

        // 1. Graphique historique principal
        function createHistoricalChart() {
            const ctx = document.getElementById('historicalEvolutionChart').getContext('2d');
            
            charts.historical = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: electionData.years,
                    datasets: Object.keys(electionData.families).map(family => ({
                        label: family,
                        data: electionData.families[family].data,
                        borderColor: electionData.families[family].color,
                        backgroundColor: electionData.families[family].color + '20',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.2,
                        pointRadius: 5,
                        pointHoverRadius: 9
                    }))
                },
                options: getLineChartOptions('Année', '% des villes >10k hab.')
            });
            
            createInteractiveLegend('historicalLegend', charts.historical);
        }

        // 2. Graphique de répartition actuelle
        function createCurrentDistributionChart() {
            const ctx = document.getElementById('currentDistributionChart').getContext('2d');
            
            charts.current = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(electionData.families),
                    datasets: [{
                        data: Object.keys(electionData.families).map(family => 
                            electionData.families[family].data[electionData.families[family].data.length - 1]
                        ),
                        backgroundColor: Object.keys(electionData.families).map(family => 
                            electionData.families[family].color
                        ),
                        borderColor: '#ffffff',
                        borderWidth: 3,
                        hoverOffset: 20
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                padding: 25,
                                usePointStyle: true,
                                font: { size: 13, weight: '600' }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw}%`;
                                }
                            }
                        }
                    },
                    cutout: '45%'
                }
            });
        }

        // 3. Graphique des tendances
        function createTrendsChart() {
            const ctx = document.getElementById('trendsChart');
            if (!ctx) return;
            
            charts.trends = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: ['1959-77', '1983-95', '2001-08', '2014-20'],
                    datasets: [
                        {
                            label: 'Droite',
                            data: [67, 53, 44, 40],
                            borderColor: '#0055A4',
                            backgroundColor: 'rgba(0, 85, 164, 0.1)',
                            borderWidth: 3,
                            tension: 0.3
                        },
                        {
                            label: 'Gauche',
                            data: [21, 35, 40, 25],
                            borderColor: '#FF5F5F',
                            backgroundColor: 'rgba(255, 95, 95, 0.1)',
                            borderWidth: 3,
                            tension: 0.3
                        },
                        {
                            label: 'Écologistes',
                            data: [0, 2, 4, 12],
                            borderColor: '#6BCF7F',
                            backgroundColor: 'rgba(107, 207, 127, 0.1)',
                            borderWidth: 3,
                            tension: 0.3
                        }
                    ]
                },
                options: getLineChartOptions('Périodes', '% des villes')
            });
        }

        // 4. Graphique de concentration urbaine
        function createUrbanConcentrationChart() {
            const ctx = document.getElementById('urbanConcentrationChart');
            if (!ctx) return;
            
            charts.urban = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: Object.keys(electionData.families),
                    datasets: [{
                        label: 'Concentration urbaine (%)',
                        data: Object.keys(electionData.families).map(family => 
                            electionData.families[family].urbanConcentration
                        ),
                        backgroundColor: Object.keys(electionData.families).map(family => 
                            electionData.families[family].color
                        )
                    }]
                },
                options: getBarChartOptions('Partis', '% en villes >100k hab.')
            });
        }

        // 5. Graphique de participation
        function createParticipationChart() {
            const ctx = document.getElementById('participationChart');
            if (!ctx) return;
            
            charts.participation = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: electionData.years,
                    datasets: [{
                        label: 'Taux de participation',
                        data: electionData.elections.map(e => e.participation),
                        borderColor: '#EF4135',
                        backgroundColor: 'rgba(239, 65, 53, 0.1)',
                        borderWidth: 4,
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: getLineChartOptions('Année', 'Taux de participation (%)', false)
            });
        }

        // 6. Graphique d'évolution des coalitions (NOUVEAU)
        function createCoalitionEvolutionChart() {
            const ctx = document.getElementById('coalitionEvolutionChart');
            if (!ctx) return;
            
            charts.coalitionEvolution = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: electionData.coalitionEvolution.years,
                    datasets: [
                        {
                            label: 'Municipalités monocolores',
                            data: electionData.coalitionEvolution.monocolore,
                            borderColor: '#0055A4',
                            backgroundColor: 'rgba(0, 85, 164, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.3
                        },
                        {
                            label: 'Coalitions à 2 partis',
                            data: electionData.coalitionEvolution.coalitions2,
                            borderColor: '#6BCF7F',
                            backgroundColor: 'rgba(107, 207, 127, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.3
                        },
                        {
                            label: 'Coalitions à 3+ partis',
                            data: electionData.coalitionEvolution.coalitions3plus,
                            borderColor: '#9C27B0',
                            backgroundColor: 'rgba(156, 39, 176, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.3
                        }
                    ]
                },
                options: getLineChartOptions('Année', '% des municipalités')
            });
        }

        // 7. Graphique droite vs gauche
        function createRightLeftComparisonChart() {
            const ctx = document.getElementById('rightLeftComparisonChart');
            if (!ctx) return;
            
            charts.rightLeft = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: electionData.years,
                    datasets: [
                        {
                            label: 'Droite',
                            data: electionData.elections.map(e => e.droite),
                            borderColor: '#0055A4',
                            backgroundColor: 'rgba(0, 85, 164, 0.1)',
                            borderWidth: 4,
                            fill: true
                        },
                        {
                            label: 'Gauche',
                            data: electionData.elections.map(e => e.gauche),
                            borderColor: '#FF5F5F',
                            backgroundColor: 'rgba(255, 95, 95, 0.1)',
                            borderWidth: 4,
                            fill: true
                        }
                    ]
                },
                options: getLineChartOptions('Année', '% des villes')
            });
        }

        // 8. Graphique performance par taille de ville
        function createCitySizeComparisonChart() {
            const ctx = document.getElementById('citySizeComparisonChart');
            if (!ctx) return;
            
            charts.citySize = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: electionData.citySizePerformance.categories,
                    datasets: [
                        {
                            label: 'Droite',
                            data: electionData.citySizePerformance.droite,
                            backgroundColor: '#0055A4'
                        },
                        {
                            label: 'Gauche',
                            data: electionData.citySizePerformance.gauche,
                            backgroundColor: '#FF5F5F'
                        },
                        {
                            label: 'Écologistes',
                            data: electionData.citySizePerformance.ecologistes,
                            backgroundColor: '#6BCF7F'
                        }
                    ]
                },
                options: getBarChartOptions('Type de ville', '% de municipalités')
            });
        }

        // 9. Graphique géographie politique
        function createPoliticalGeographyChart() {
            const ctx = document.getElementById('politicalGeographyChart');
            if (!ctx) return;
            
            charts.geography = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: electionData.regionalStrongholds.regions,
                    datasets: [
                        {
                            label: 'Droite (LR)',
                            data: electionData.regionalStrongholds.LR,
                            backgroundColor: '#0055A4'
                        },
                        {
                            label: 'Gauche (PS)',
                            data: electionData.regionalStrongholds.PS,
                            backgroundColor: '#FF5F5F'
                        },
                        {
                            label: 'Écologistes (EELV)',
                            data: electionData.regionalStrongholds.EELV,
                            backgroundColor: '#6BCF7F'
                        }
                    ]
                },
                options: getBarChartOptions('Régions', '% de villes')
            });
            
            createGeographyLegend();
        }

        // 10. Graphique des bastions régionaux (NOUVEAU)
        function createRegionalStrongholdsChart() {
            const ctx = document.getElementById('regionalStrongholdsChart');
            if (!ctx) return;
            
            charts.regionalStrongholds = new Chart(ctx.getContext('2d'), {
                type: 'radar',
                data: {
                    labels: electionData.regionalStrongholds.regions,
                    datasets: [
                        {
                            label: 'LR',
                            data: electionData.regionalStrongholds.LR,
                            borderColor: '#0055A4',
                            backgroundColor: 'rgba(0, 85, 164, 0.2)',
                            borderWidth: 2
                        },
                        {
                            label: 'PS',
                            data: electionData.regionalStrongholds.PS,
                            borderColor: '#FF5F5F',
                            backgroundColor: 'rgba(255, 95, 95, 0.2)',
                            borderWidth: 2
                        },
                        {
                            label: 'EELV',
                            data: electionData.regionalStrongholds.EELV,
                            borderColor: '#6BCF7F',
                            backgroundColor: 'rgba(107, 207, 127, 0.2)',
                            borderWidth: 2
                        },
                        {
                            label: 'RN',
                            data: electionData.regionalStrongholds.RN,
                            borderColor: '#1A237E',
                            backgroundColor: 'rgba(26, 35, 126, 0.2)',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        r: {
                            angleLines: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            suggestedMin: 0,
                            suggestedMax: 70
                        }
                    }
                }
            });
        }

        // 11. Graphique typologie des territoires (NOUVEAU)
        function createTerritoryTypologyChart() {
            const ctx = document.getElementById('territoryTypologyChart');
            if (!ctx) return;
            
            charts.territoryTypology = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: electionData.territoryTypology.types,
                    datasets: [
                        {
                            label: 'Droite',
                            data: electionData.territoryTypology.droite,
                            backgroundColor: '#0055A4'
                        },
                        {
                            label: 'Gauche',
                            data: electionData.territoryTypology.gauche,
                            backgroundColor: '#FF5F5F'
                        },
                        {
                            label: 'Écologistes',
                            data: electionData.territoryTypology.ecologistes,
                            backgroundColor: '#6BCF7F'
                        },
                        {
                            label: 'Centre',
                            data: electionData.territoryTypology.centre,
                            backgroundColor: '#FFB74D'
                        },
                        {
                            label: 'Divers',
                            data: electionData.territoryTypology.divers,
                            backgroundColor: '#AAAAAA'
                        }
                    ]
                },
                options: getBarChartOptions('Type de territoire', '% de municipalités')
            });
        }

        // 12. Graphique des coalitions (2020)
        function createCoalitionChart() {
            const ctx = document.getElementById('coalitionChart');
            if (!ctx) return;
            
            charts.coalition = new Chart(ctx.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: ['Monocolore', 'Coalition 2 partis', 'Coalition 3+ partis', 'Liste diverse'],
                    datasets: [{
                        data: [35, 40, 20, 5],
                        backgroundColor: ['#0055A4', '#6BCF7F', '#9C27B0', '#AAAAAA'],
                        borderColor: '#ffffff',
                        borderWidth: 3,
                        hoverOffset: 20
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw}%`;
                                }
                            }
                        }
                    },
                    cutout: '45%'
                }
            });
        }

        // 13. Graphique des stratégies de conquête
        function createConquestStrategyChart() {
            const ctx = document.getElementById('conquestStrategyChart');
            if (!ctx) return;
            
            charts.conquestStrategy = new Chart(ctx.getContext('2d'), {
                type: 'radar',
                data: {
                    labels: ['Ancrage local', 'Soutien national', 'Alliances', 'Visibilité médiatique'],
                    datasets: [
                        {
                            label: 'LR',
                            data: electionData.conquestStrategies.localAnchor,
                            borderColor: '#0055A4',
                            backgroundColor: 'rgba(0, 85, 164, 0.2)',
                            borderWidth: 2
                        },
                        {
                            label: 'PS',
                            data: electionData.conquestStrategies.nationalSupport,
                            borderColor: '#FF5F5F',
                            backgroundColor: 'rgba(255, 95, 95, 0.2)',
                            borderWidth: 2
                        },
                        {
                            label: 'EELV',
                            data: electionData.conquestStrategies.coalitionBuilding,
                            borderColor: '#6BCF7F',
                            backgroundColor: 'rgba(107, 207, 127, 0.2)',
                            borderWidth: 2
                        },
                        {
                            label: 'LREM',
                            data: electionData.conquestStrategies.mediaVisibility,
                            borderColor: '#FFB74D',
                            backgroundColor: 'rgba(255, 183, 77, 0.2)',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        r: {
                            angleLines: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            suggestedMin: 0,
                            suggestedMax: 100
                        }
                    }
                }
            });
        }

        // 14. Graphique profil des maires
        function createMayorProfileChart() {
            const ctx = document.getElementById('mayorProfileChart');
            if (!ctx) return;
            
            charts.mayorProfile = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['LR', 'PS', 'EELV', 'LREM', 'Divers'],
                    datasets: [
                        {
                            label: 'Âge moyen',
                            data: [62, 59, 48, 52, 56],
                            backgroundColor: '#0055A4',
                            yAxisID: 'y'
                        },
                        {
                            label: '% Femmes',
                            data: [18, 35, 45, 38, 28],
                            backgroundColor: '#FF5F5F',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            min: 40,
                            max: 70
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            min: 0,
                            max: 50,
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });
        }

        // Fonctions utilitaires
        function getLineChartOptions(xLabel, yLabel, beginAtZero = true) {
            return {
                responsive: true,
                maintainAspectRatio: true,
                aspectRatio: 2,
                plugins: {
                    legend: {
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: beginAtZero,
                        max: beginAtZero ? 80 : undefined,
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    }
                }
            };
        }

        function getBarChartOptions(xLabel, yLabel) {
            return {
                responsive: true,
                maintainAspectRatio: true,
                aspectRatio: 2,
                plugins: {
                    legend: {
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 70,
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    }
                }
            };
        }

        function createInteractiveLegend(containerId, chart) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = '';
            
            Object.keys(electionData.families).forEach((family, index) => {
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                legendItem.innerHTML = `
                    <div class="legend-color" style="background-color: ${electionData.families[family].color}"></div>
                    <span>${family}</span>
                    <span style="margin-left: auto; font-weight: 700; color: ${electionData.families[family].color}">
                        ${electionData.families[family].data[electionData.families[family].data.length - 1]}%
                    </span>
                `;
                
                legendItem.addEventListener('click', function() {
                    const meta = chart.getDatasetMeta(index);
                    meta.hidden = meta.hidden === null ? true : !meta.hidden;
                    chart.update();
                    this.style.opacity = meta.hidden ? '0.5' : '1';
                });
                
                container.appendChild(legendItem);
            });
        }

        function createGeographyLegend() {
            const container = document.getElementById('geographyLegend');
            if (!container) return;
            
            container.innerHTML = '';
            
            const parties = [
                { name: 'Droite (LR)', color: '#0055A4', value: '38%' },
                { name: 'Gauche (PS)', color: '#FF5F5F', value: '21%' },
                { name: 'Écologistes (EELV)', color: '#6BCF7F', value: '12%' },
                { name: 'Centre (LREM)', color: '#FFB74D', value: '14%' },
                { name: 'Divers', color: '#AAAAAA', value: '12%' }
            ];
            
            parties.forEach(party => {
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                legendItem.innerHTML = `
                    <div class="legend-color" style="background-color: ${party.color}"></div>
                    <span>${party.name}</span>
                    <span style="margin-left: auto; font-weight: 700; color: ${party.color}">
                        ${party.value}
                    </span>
                `;
                container.appendChild(legendItem);
            });
        }

        function populateHistoricalTable() {
            const tbody = document.getElementById('historicalDataBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            electionData.elections.forEach(election => {
                const row = document.createElement('tr');
                
                const prevIndex = electionData.elections.findIndex(e => e.year === election.year) - 1;
                let droiteTrend = '', gaucheTrend = '';
                
                if (prevIndex >= 0) {
                    const prev = electionData.elections[prevIndex];
                    const droiteDiff = election.droite - prev.droite;
                    const gaucheDiff = election.gauche - prev.gauche;
                    
                    droiteTrend = droiteDiff > 0 ? 
                        `<span class="trend-up">+${droiteDiff}%</span>` : 
                        droiteDiff < 0 ? `<span class="trend-down">${droiteDiff}%</span>` : '';
                        
                    gaucheTrend = gaucheDiff > 0 ? 
                        `<span class="trend-up">+${gaucheDiff}%</span>` : 
                        gaucheDiff < 0 ? `<span class="trend-down">${gaucheDiff}%</span>` : '';
                }
                
                row.innerHTML = `
                    <td><strong>${election.year}</strong></td>
                    <td>${election.droite}% ${droiteTrend}</td>
                    <td>${election.gauche}% ${gaucheTrend}</td>
                    <td>${election.ecologistes}%</td>
                    <td>${election.centre}%</td>
                    <td>${election.extremeDroite}%</td>
                    <td>${election.divers}%</td>
                    <td>${election.participation}%</td>
                    <td>${election.contexte}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function populateComparativeTable() {
            const tbody = document.getElementById('comparativeDataBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            Object.keys(electionData.families).forEach(family => {
                const data = electionData.families[family];
                const evolution = data.data[data.data.length - 1] - data.data[0];
                const evolutionText = evolution > 0 ? 
                    `<span class="trend-up">+${evolution}%</span>` : 
                    evolution < 0 ? `<span class="trend-down">${evolution}%</span>` : 'stable';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${family}</strong></td>
                    <td>${data.data[1]}%</td>
                    <td>${data.data[7]}%</td>
                    <td>${data.data[data.data.length - 1]}%</td>
                    <td>${evolutionText}</td>
                    <td>${data.renewalRate}%</td>
                    <td>${data.urbanConcentration}%</td>
                    <td>${data.mayorAge} ans</td>
                `;
                tbody.appendChild(row);
            });
        }

        function setupEventListeners() {
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    showTab(tabId);
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            });
            
            document.getElementById('exportData').addEventListener('click', exportData);
            document.getElementById('toggleData').addEventListener('click', toggleRawData);
            
            const scrollBtn = document.getElementById('scrollTopBtn');
            window.addEventListener('scroll', function() {
                scrollBtn.classList.toggle('visible', window.scrollY > 500);
            });
            scrollBtn.addEventListener('click', function() {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            const activeTab = document.getElementById(`${tabId}-tab`);
            if (activeTab) activeTab.classList.add('active');
        }

        function exportData() {
            let csv = 'Année,Droite (%),Gauche (%),Écologistes (%),Centre (%),Extrême-droite (%),Divers (%),Participation (%)\n';
            electionData.elections.forEach(election => {
                csv += `${election.year},${election.droite},${election.gauche},${election.ecologistes},${election.centre},${election.extremeDroite},${election.divers},${election.participation}\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'elections_municipales_1959_2020.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            showToast('Données exportées avec succès !');
        }

        function toggleRawData() {
            showToast('Affichage des données brutes activé/désactivé');
        }

        function showToast(message) {
            let toast = document.getElementById('toast');
            if (!toast) {
                toast = document.createElement('div');
                toast.id = 'toast';
                toast.style.cssText = `
                    position: fixed;
                    bottom: 30px;
                    left: 50%;
                    transform: translateX(-50%) translateY(100px);
                    background: linear-gradient(135deg, var(--bleu-france), var(--rouge-france));
                    color: white;
                    padding: 18px 30px;
                    border-radius: 12px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                    z-index: 10000;
                    transition: transform 0.4s;
                    font-weight: 600;
                    font-size: 1.1rem;
                    display: flex;
                    align-items: center;
                    gap: 15px;
                `;
                document.body.appendChild(toast);
            }
            toast.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
            toast.style.transform = 'translateX(-50%) translateY(0)';
            setTimeout(() => {
                toast.style.transform = 'translateX(-50%) translateY(100px)';
            }, 3000);
        }
    </script>
</body>
</html>